# Phase 5: Team Management & Lifelines

- **Dependencies:** Phase 4 (Core gameplay functional)
- **Status:** Completed
- **USER_JOURNEY Reference:** [Journey 3, Phase B: Lifeline Usage](../USER_JOURNEY.md#step-5-lifeline-usage-before-answer-lock), [Journey 3, Phase C: Team Transition](../USER_JOURNEY.md#phase-c-transition-to-next-team-automatic)

| Requirement ID    | Description                           | User Story                                                                            | Expected Behavior/Outcome                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ----------------- | ------------------------------------- | ------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **P5-REQ-001** ‚úÖ | Team Status Panel Component           | As a host, I need to see all teams so that I can monitor overall progress             | - Grid/list of team cards<br>- Real-time status updates<br>- Color-coded by status<br>- Scrollable if many teams                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **P5-REQ-002** ‚úÖ | Team Card Component                   | As a host, I need individual team displays so that I can see team details at a glance | - Team name, status badge<br>- Progress: X/QUESTIONS_PER_SET questions<br>- Current prize amount<br>- Lifelines available (icons)<br>- Color: Blue=active, Grey=waiting, Red=eliminated, Green=completed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **P5-REQ-003** ‚úÖ | Active Team Highlighting              | As a host, I need to identify the current team so that I know who is playing          | - Active team card: blue border, blue background<br>- Scroll active team into view<br>- Pulse animation (subtle)<br>- "PLAYING NOW" badge                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **P5-REQ-004** ‚úÖ | Lifeline Controls Component           | As a host, I need lifeline buttons so that I can activate them when requested         | - "Phone-a-Friend" button<br>- "50/50" button<br>- **WWBAM Timing: Enabled ONLY when question visible AND answer NOT locked**<br>- **One-per-question enforcement: Both disabled after ONE is used**<br>- Disabled states:<br>&nbsp;&nbsp;‚Ä¢ Globally used (team used it in previous question)<br>&nbsp;&nbsp;‚Ä¢ Used this question (one lifeline already activated)<br>&nbsp;&nbsp;‚Ä¢ Answer locked (too late to use)<br>&nbsp;&nbsp;‚Ä¢ Question not visible (not yet displayed to public)<br>- Visual indicators: Available (green) \| Used (red X) \| Locked (grey)<br>- Only enabled for active team                                                                                    |
| **P5-REQ-005** ‚úÖ | Phone-a-Friend Activation             | As a host, I need to activate Phone-a-Friend so that teams can call for help          | - Click button<br>- Atomic Firebase update:<br>&nbsp;&nbsp;‚Ä¢ game-state/active-lifeline = 'phone-a-friend'<br>&nbsp;&nbsp;‚Ä¢ teams/{teamId}/lifelines-available/phoneAFriend = false<br>- Both lifeline buttons become disabled (one-per-question rule)<br>- Button becomes greyed out<br>- Team card updates icon: ‚ùå Phone-a-Friend<br>- Show "üìû Phone-a-Friend Active - Timer paused" message<br>- Public display shows "Phone-a-Friend in use"<br>- Manual resume by host clears active-lifeline<br>- **WWBAM Rule: Must be activated BEFORE answer selection**<br>- **One-per-question: Disables 50/50 button for this question**                                                  |
| **P5-REQ-006** ‚úÖ | 50/50 Activation                      | As a host, I need to activate 50/50 so that two incorrect options are removed         | - Click button<br>- Apply 50/50 logic (remove 2 incorrect options)<br>- Atomic Firebase update:<br>&nbsp;&nbsp;‚Ä¢ game-state/current-question/options (filtered)<br>&nbsp;&nbsp;‚Ä¢ game-state/active-lifeline = 'fifty-fifty'<br>&nbsp;&nbsp;‚Ä¢ teams/{teamId}/lifelines-available/fiftyFifty = false<br>- Public display shows only 2 options instantly<br>- Both lifeline buttons become disabled (one-per-question rule)<br>- Button becomes greyed out<br>- Team card updates icon: ‚ùå 50/50<br>- Auto-clear active-lifeline after 1 second<br>- **WWBAM Rule: Must be activated BEFORE answer selection**<br>- **One-per-question: Disables Phone-a-Friend button for this question** |
| **P5-REQ-007** ‚úÖ | One Lifeline Per Question Enforcement | As a system, I need to enforce one-per-question so that WWBAM rules are followed      | - Track if lifeline used this question (local state)<br>- Disable both buttons after ONE is used<br>- Reset flag on new question load<br>- Prevent double-usage via UI state<br>- Log lifeline usage per question<br>- Display "1 Used This Question" badge when applicable                                                                                                                                                                                                                                                                                                                                                                                                             |
| **P5-REQ-008** ‚úÖ | Lifeline State Synchronization        | As a system, I need to sync lifeline states so that all views are consistent          | - Update team in Firebase (atomic with game-state)<br>- Update team card UI<br>- Update lifeline buttons<br>- Update game-state/active-lifeline<br>- Persist across page reloads<br>- Real-time to all connected clients                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **P5-REQ-009** ‚úÖ | Team Elimination Logic                | As a system, I need to eliminate teams so that game rules are enforced                | - Set status = 'eliminated'<br>- Add eliminated-at timestamp<br>- Freeze current-prize at last correct<br>- Clear active-lifeline state<br>- Disable all controls for team<br>- Card turns red with badge<br>- **WWBAM: No lifeline checking after wrong answer**                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **P5-REQ-010** ‚úÖ | Team Completion Logic                 | As a system, I need to mark teams as winners so that success is recorded              | - After Q20 answered correctly<br>- Set status = 'completed'<br>- Set final prize (max from prize-structure)<br>- Card turns green with "WINNER" badge<br>- Celebration animation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **P5-REQ-011** ‚úÖ | Next Team Transition                  | As a host, I need to move to next team so that gameplay continues                     | - "Next Team" button<br>- Get next from play-queue<br>- Atomic Firebase update:<br>&nbsp;&nbsp;‚Ä¢ Set next team to 'active'<br>&nbsp;&nbsp;‚Ä¢ Reset question state<br>&nbsp;&nbsp;‚Ä¢ Clear active-lifeline<br>- Scroll to new active team<br>- Reset lifeline-used-this-question flag                                                                                                                                                                                                                                                                                                                                                                                                      |
| **P5-REQ-012** ‚úÖ | Lifeline Icons Display                | As a user, I need to see lifeline status so that I know what's available              | - Phone icon: üìû (available), ‚ùå (used)<br>- Scissors icon: ‚úÇÔ∏è (available), ‚ùå (used)<br>- Show on team cards<br>- Update in real-time<br>- Tooltips on hover                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **P5-REQ-013** ‚úÖ | Active Lifeline Indicator             | As a user, I need to see when a lifeline is active so that I understand game state    | - Show when game-state/active-lifeline is not null<br>- "üìû Phone-a-Friend Active" banner with Resume button<br>- Public display shows active lifeline status<br>- Auto-clear after 50/50 completes (1 sec delay)<br>- Manual clear after Phone-a-Friend via Resume button                                                                                                                                                                                                                                                                                                                                                                                                              |
|                   |

**Phase 5 Acceptance Criteria:**

- ‚úÖ Lifeline buttons appear on host panel
- ‚úÖ Phone-a-Friend activates and sets active-lifeline
- ‚úÖ 50/50 removes 2 incorrect options and updates display
- ‚úÖ One-per-question rule enforced (both buttons disabled after one used)
- ‚úÖ Lifelines only enabled when question visible and answer not locked
- ‚úÖ Lifelines disabled after answer is locked (too late)
- ‚úÖ Team cards show lifeline status icons
- ‚úÖ Lifeline state syncs across all clients via Firebase
- ‚úÖ Active lifeline cleared on Resume (Phone) or auto (50/50)
- ‚úÖ New question resets lifeline-used-this-question flag
- ‚úÖ Wrong answer eliminates team directly (no lifeline checking)
- ‚úÖ All lifeline operations use atomic Firebase updates
- ‚úÖ Public display shows active lifeline status
- ‚úÖ WWBAM rules enforced: lifelines before answer, not after
