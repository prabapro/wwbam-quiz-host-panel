# Phase 4: Core Game Play - Question Flow

- **Dependencies:** Phase 3 (Game initialized and started)
- **Status:** Completed
- **USER_JOURNEY Reference:** [Journey 3, Phase B: Question Cycle](../USER_JOURNEY.md#phase-b-question-cycle-repeat-up-to-questions_per_set-times-or-until-elimination)

| Requirement ID    | Description                      | User Story                                                                         | Expected Behavior/Outcome                                                                                                                                                                                                                                        |
| ----------------- | -------------------------------- | ---------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **P4-REQ-001** ✅ | Question Control Panel Component | As a host, I need a question control panel so that I can manage question display   | - Compact panel with all controls (`/play`)<br>- Question preview (host only)<br>- Action buttons: Load, Show, Lock<br>- Current question number indicator                                                                                                       |
| **P4-REQ-002** ✅ | Load Question Functionality      | As a host, I need to load questions so that I can preview before showing           | - Fetch next question from Firebase question-sets<br>- Display text + options to HOST<br>- Display correct answer (green indicator)<br>- Enable "Push to Display" button                                                                                         |
| **P4-REQ-003** ✅ | Push to Display to Public        | As a host, I need to display questions so that teams can see them                  | - Push question to Firebase (WITHOUT correct answer)<br>- Set question-visible = true<br>- Set options-visible = true<br>- Public display updates instantly<br>- Enable lifeline buttons                                                                         |
| **P4-REQ-004** ✅ | Answer Pad Component             | As a host, I need an answer input so that I can register team's answer             | - 4 buttons: A, B, C, D<br>- Click to select (yellow highlight)<br>- Can change selection before lock<br>- Visual feedback on selection                                                                                                                          |
| **P4-REQ-005** ✅ | Lock Answer Functionality        | As a host, I need to lock answers so that validation occurs                        | - "Lock Answer" button<br>- Disabled until answer selected<br>- Triggers automatic validation<br>- Cannot unlock after validation<br>- Disables lifeline buttons (too late to use)                                                                               |
| **P4-REQ-006** ✅ | Automatic Answer Validation      | As a system, I need to validate answers so that correct/incorrect is determined    | - Compare selected vs Firebase correct answer<br>- Return boolean + correct answer<br>- Trigger appropriate flow (correct/incorrect)<br>- Log validation event                                                                                                   |
| **P4-REQ-007** ✅ | Correct Answer Flow              | As a system, I need to handle correct answers so that progress updates             | - Update Firebase:<br> → team current-prize<br> → team current-question-index<br> → team questions-answered<br>- Set answer-revealed = true<br>- Show green checkmark on public display<br>- Enable "Next Question"                                              |
| **P4-REQ-008** ✅ | Incorrect Answer Flow            | As a system, I need to handle incorrect answers so that elimination occurs         | - **WWBAM Rule: Direct elimination (no lifeline checking)**<br>- Lifelines must be used BEFORE locking answer<br>- Auto-eliminate team<br>- Clear any active lifeline state<br>- Show red X on public display<br>- Do NOT update prize (stays at previous level) |
| **P4-REQ-009** ✅ | Answer Reveal on Public Display  | As a public viewer, I need to see correct answers so that I can learn              | - Highlight correct option (green)<br>- Show incorrect selection (red, if any)<br>- Display final prize<br>- Animate transition                                                                                                                                  |
| **P4-REQ-010** ✅ | Question Visibility Toggle       | As a host, I need to control visibility so that questions appear/disappear         | - "Show Question" button → sets question-visible = true<br>- "Hide Question" button → sets question-visible = false<br>- Public display reacts in real-time<br>- Default: hidden                                                                                 |
| **P4-REQ-011** ✅ | Clear Question Display           | As a host, I need to clear questions so that I can reset for next question         | - "Clear Question" button<br>- Resets all question state in Firebase<br>- Clears host view<br>- Public display returns to waiting state<br>- Reset answer pad<br>- Clear active lifeline state                                                                   |
| **P4-REQ-012** ✅ | Next Question Navigation         | As a host, I need to proceed to next question so that gameplay continues           | - "Next Question" button<br>- Clear current question display<br>- Reset answer pad<br>- Reset lifeline-used-this-question flag<br>- Return to "Load Question" state<br>- Update question counter UI                                                              |
| **P4-REQ-013** ✅ | Question Progress Indicator      | As a host, I need to track progress so that I know where we are in the game        | - Display "Question X/QUESTIONS_PER_SET"<br>- Update in real-time<br>- Show on status bar<br>- Visual progress bar (optional)                                                                                                                                    |
| **P4-REQ-014** ✅ | Prize Update on Correct Answer   | As a system, I need to update prizes so that teams see their winnings              | - Calculate prize from prize-structure array<br>- Update team current-prize<br>- Sync to Firebase<br>- Display updated prize on team card<br>- Show prize animation on public display                                                                            |
| **P4-REQ-015** ✅ | Team Elimination Logic           | As a system, I need to eliminate teams so that wrong answers end their turn        | - Set team status = 'eliminated'<br>- Freeze current-prize at last correct value<br>- Add eliminated-at timestamp<br>- Show red card with "Eliminated" badge<br>- Enable "Next Team" button                                                                      |
| **P4-REQ-016** ✅ | Answer Selection Validation      | As a system, I need to validate selections so that only valid answers are accepted | - Only A, B, C, D allowed<br>- Cannot select if answer locked<br>- Cannot select if question not visible<br>- Case-insensitive validation                                                                                                                        |
| **P4-REQ-017** ✅ | Firebase State Synchronization   | As a system, I need Firebase sync so that all clients see the same state           | - Real-time listeners on game-state<br>- Atomic multi-path updates<br>- Server timestamps for consistency<br>- Handle connection failures gracefully                                                                                                             |

**Key Points:**

- Lifelines are **decision tools**, not rescue mechanisms
- Must be activated **before** answer selection/lock
- Once answer is locked and wrong, **no lifeline can save the team**
- See Phase 5 for full lifeline implementation details
