# Phase 4: Core Game Play - Question Flow

- **Dependencies:** Phase 3 (Game initialized and started)
- **Status:** In Progress
- **USER_JOURNEY Reference:** [Journey 3, Phase B: Question Cycle](../USER_JOURNEY.md#phase-b-question-cycle-repeat-up-to-questions_per_set-times-or-until-elimination)

| Requirement ID    | Description                        | User Story                                                                                 | Expected Behavior/Outcome                                                                                                                                                                                           |
| ----------------- | ---------------------------------- | ------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **P4-REQ-001** ✅ | Question Control Panel Component   | As a host, I need a question control panel so that I can manage question display           | - Compact panel with all controls (`/play`)<br>- Question preview (host only)<br>- Action buttons: Load, Show, Lock<br>- Current question number indicator                                                          |
| **P4-REQ-002** ✅ | Load Question Functionality        | As a host, I need to load questions so that I can preview before showing                   | - Fetch next question from Firebase question-sets<br>- Display text + options to HOST<br>- Display correct answer (green indicator)<br>- Enable "Push to Display" button                                            |
| **P4-REQ-003** ✅ | Push to Display to Public          | As a host, I need to display questions so that teams can see them                          | - Push question to Firebase (WITHOUT correct answer)<br>- Set question-visible = true<br>- Set options-visible = true<br>- Public display updates instantly                                                         |
| **P4-REQ-004** ✅ | Answer Pad Component               | As a host, I need an answer input so that I can register team's answer                     | - 4 buttons: A, B, C, D<br>- Click to select (yellow highlight)<br>- Can change selection before lock<br>- Visual feedback on selection                                                                             |
| **P4-REQ-005** ✅ | Lock Answer Functionality          | As a host, I need to lock answers so that validation occurs                                | - "Lock Answer" button<br>- Disabled until answer selected<br>- Triggers automatic validation<br>- Cannot unlock after validation                                                                                   |
| **P4-REQ-006** ✅ | Automatic Answer Validation        | As a system, I need to validate answers so that correct/incorrect is determined            | - Compare selected vs Firebase correct answer<br>- Return boolean + correct answer<br>- Trigger appropriate flow (correct/incorrect)<br>- Log validation event                                                      |
| **P4-REQ-007** ✅ | Correct Answer Flow                | As a system, I need to handle correct answers so that progress updates                     | - Update Firebase:<br> → team current-prize<br> → team current-question-index<br> → team questions-answered<br>- Set answer-revealed = true<br>- Show green checkmark on public display<br>- Enable "Next Question" |
| **P4-REQ-008** ✅ | Incorrect Answer Flow              | As a system, I need to handle incorrect answers so that lifeline/elimination flow triggers | - Check if lifelines available<br>- If yes: Offer lifeline modal<br>- If no: Auto-eliminate team<br>- Show red X on public display<br>- Do NOT update prize (stays at previous level)                               |
| **P4-REQ-009** ✅ | Answer Reveal on Public Display    | As a public viewer, I need to see correct answers so that I can learn                      | - Highlight correct option (green)<br>- Show incorrect selection (red, if any)<br>- Display final prize<br>- Animate transition                                                                                     |
| **P4-REQ-010** ✅ | Question Visibility Toggle         | As a host, I need to control visibility so that questions appear/disappear                 | - "Show Question" button → sets question-visible = true<br>- "Hide Question" button → sets question-visible = false<br>- Public display reacts in real-time<br>- Default: hidden                                    |
| **P4-REQ-011** ✅ | Clear Question Display             | As a host, I need to clear questions so that I can reset for next question                 | - "Clear Question" button<br>- Resets all question state in Firebase<br>- Clears host view<br>- Public display returns to waiting state<br>- Reset answer pad button                                                |
| **P4-REQ-012** ✅ | Next Question Navigation           | As a host, I need to proceed to next question so that gameplay continues                   | - "Next Question" button<br>- Clear current question display<br>- Reset answer pad<br>- Return to "Load Question" state<br>- Update question counter UI                                                             |
| **P4-REQ-013** ✅ | Question Progress Indicator        | As a host, I need to track progress so that I know how far team has advanced               | - "Question X/QUESTIONS_PER_SET" display<br>- Progress bar (optional)<br>- Highlight current prize level<br>- Color code by milestone                                                                               |
| **P4-REQ-014** ✅ | Host Question View                 | As a host, I need to see correct answers so that I can validate responses                  | - Question text (large, readable)<br>- All 4 options clearly labeled<br>- Correct answer marked (✓ green indicator)<br>- "Visible to HOST ONLY" badge<br>- Cannot be shared to public display                       |
| **P4-REQ-015** ⌛ | Incorrect Answer with Lifelines    | As a host, I need to offer lifelines so that teams get second chances                      | - Show dialog: "Wrong Answer - Lifelines Available"<br>- Display available lifelines<br>- Buttons: "Offer Lifeline" or "Eliminate Team"<br>- Do NOT reveal correct answer yet                                       |
| **P4-REQ-016** ⌛ | Incorrect Answer without Lifelines | As a system, I need to eliminate teams so that game rules are enforced                     | - Show X animation<br>- Reveal correct answer (green)<br>- Set team status = 'eliminated'<br>- Freeze final prize<br>- Show "Next Team" button                                                                      |

**Phase 4 Acceptance Criteria:**

- ✅ Questions load from Firebase correctly
- ✅ Only question/options pushed to Firebase game-state (no answer)
- ✅ Answer validation is accurate
- ✅ Correct flow updates prize and progresses
- ✅ Incorrect flow checks lifelines appropriately
- ✅ UI clearly distinguishes host vs public view
- ✅ Modular structure implemented with proper separation of concerns
- ✅ Custom hooks centralize business logic
- ✅ Utility functions are pure and testable
